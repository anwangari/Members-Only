<h2>All Messages</h2>

<% if (currentUser) { %>
  <p><a href="/messages/new">+ Create New Message</a></p>
  
  <% if (!currentUser.is_member) { %>
    <p><a href="/member/join">Join the Club</a> to see who wrote these messages!</p>
  <% } %>
  
  <% if (currentUser.is_member && !currentUser.is_admin) { %>
    <p><a href="/member/admin">Become an Admin</a> to moderate messages</p>
  <% } %>
<% } else { %>
  <p>Please <a href="/login">log in</a> to post messages.</p>
<% } %>

<hr>

<% if (messages.length === 0) { %>
  <p>No messages yet. Be the first to post!</p>
<% } else { %>
  <ul>
    <% messages.forEach(function(message) { %>
      <li>
        <h3><%= message.title %></h3>
        <p><%= message.text %></p>
        
        <% if (currentUser && currentUser.is_member) { %>
          <small>
            Posted by <strong><%= message.first_name %> <%= message.last_name %></strong>
            on <%= new Date(message.created_at).toLocaleString() %>
          </small>
        <% } else { %>
          <small>Posted by <strong>Anonymous</strong></small>
        <% } %>
        
        <% if (currentUser && currentUser.is_admin) { %>
          <form method="POST" action="/messages/<%= message.id %>/delete" style="display:inline;">
            <button type="submit" onclick="return confirm('Delete this message?')">Delete</button>
          </form>
        <% } %>
      </li>
    <% }); %>
  </ul>
<% } %>