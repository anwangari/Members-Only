<h2>All Messages</h2>

<% if (currentUser) { %>
  <div style="margin-bottom: 20px;">
    <a href="/messages/new" style="padding: 10px 15px; background-color: #007bff; color: white; text-decoration: none; border-radius: 5px;">+ New Message</a>
    
    <% if (!currentUser.is_member) { %>
      <p style="margin-top: 15px;">
        <em>Want to see who wrote these messages? <a href="/member/join">Join the Club</a></em>
      </p>
    <% } %>
    
    <% if (currentUser.is_member && !currentUser.is_admin) { %>
      <p style="margin-top: 15px;">
        <em>Interested in moderating? <a href="/member/admin">Become Admin</a></em>
      </p>
    <% } %>
  </div>
<% } else { %>
  <p><em>Please <a href="/login">log in</a> to create messages and see authors.</em></p>
<% } %>

<% if (messages.length === 0) { %>
  <p>No messages yet. Be the first to post!</p>
<% } else { %>
  <ul style="list-style: none; padding: 0;">
    <% messages.forEach(m => { %>
      <li style="border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 5px; background-color: #f9f9f9;">
        <h3 style="margin-top: 0;"><%= m.title %></h3>
        <p><%= m.text %></p>
        
        <div style="margin-top: 10px; font-size: 0.9em; color: #666;">
          <% if (currentUser && currentUser.is_member) { %>
            <em>Posted by <strong><%= m.first_name %> <%= m.last_name %></strong> on <%= m.created_at.toLocaleString() %></em>
          <% } else { %>
            <em>Posted by <strong>Anonymous</strong></em>
          <% } %>
        </div>
        
        <% if (currentUser && currentUser.is_admin) { %>
          <form method="POST" action="/messages/<%= m.id %>/delete" style="margin-top: 10px;">
            <button 
              type="submit" 
              onclick="return confirm('Are you sure you want to delete this message?');"
              style="background-color: #dc3545; color: white; padding: 5px 10px; border: none; border-radius: 3px; cursor: pointer;"
            >
              Delete Message
            </button>
          </form>
        <% } %>
      </li>
    <% }) %>
  </ul>
<% } %>