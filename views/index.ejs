<h2>All Messages</h2>

<% if (currentUser) { %>
  <div class="action-links">
    <a href="/messages/new">ğŸ“ New Message</a>
    <% if (!currentUser.is_member) { %>
      <p>ğŸ”’ Want to see who wrote these messages? <a href="/member/join">Join the Club</a></p>
    <% } %>
    <% if (currentUser.is_member && !currentUser.is_admin) { %>
      <p>â­ Interested in moderating? <a href="/member/admin">Become Admin</a></p>
    <% } %>
  </div>
<% } else { %>
  <div class="action-links">
    <p>Please <a href="/login">log in</a> or <a href="/signup">sign up</a> to post messages.</p>
  </div>
<% } %>

<% if (messages.length === 0) { %>
  <div class="empty-state">
    <p>No messages yet. Be the first to post! ğŸ‰</p>
  </div>
<% } else { %>
  <ul class="messages-grid">
    <% messages.forEach(m => { %>
      <li class="message-card">
        <div class="message-title"><%= m.title %></div>
        <div class="message-content"><%= m.text %></div>
        <div class="message-meta">
          <% if (currentUser && currentUser.is_member) { %>
            Posted by <strong><%= m.first_name %> <%= m.last_name %></strong><br>
            <%= new Date(m.created_at).toLocaleString() %>
          <% } else { %>
            Posted by <strong>Anonymous</strong>
          <% } %>
        </div>
        <% if (currentUser && currentUser.is_admin) { %>
          <div class="message-actions">
            <form method="POST" action="/messages/<%= m.id %>/delete">
              <button type="submit" onclick="return confirm('Delete this message?')">ğŸ—‘ï¸ Delete</button>
            </form>
          </div>
        <% } %>
      </li>
    <% }) %>
  </ul>
<% } %>